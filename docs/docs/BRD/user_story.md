# User Stories

## User Story Format

**As a** `<actor>`, **I want to** `<function>`, **so that** `<benefit/constraint>`

## User Story Table

| ID    | Function Group            | User Story                                                                                                                                      | Description                                                                                              | Solution                                                                                                                                                                                                                                                                                                                                                                         |
| ----- | ------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| US-01 | Authentication            | As a **User** (Customer/Staff/Admin), I want to **sign in to the system**, so that **I can access features according to my role**.              | Users need to authenticate themselves to access role-specific functionalities in the TMS.                | Implement authentication using username/email and password with role-based access control. Check account lock status and redirect users to appropriate dashboards based on their role.                                                                                                                                                                                           |
| US-02 | Authentication            | As a **Customer**, I want to **sign up for a new account**, so that **I can book trips and manage my travel plans**.                            | New customers need to create accounts to use the booking system.                                         | Provide registration form with username, password, email, full name, and personal details. Validate uniqueness of username/email, enforce password strength requirements (≥8 chars, mixed case, numbers), auto-assign CUSTOMER role, and send confirmation email.                                                                                                                |
| US-03 | Authentication            | As a **User**, I want to **reset my password if I forget it**, so that **I can regain access to my account**.                                   | Users who forget passwords need a recovery mechanism.                                                    | Implement password reset flow: send reset link via email, verify token validity, allow user to set new password, enforce password strength requirements.                                                                                                                                                                                                                         |
| US-04 | Authentication            | As a **User**, I want to **manage my profile information**, so that **I can keep my personal details up to date**.                              | Users need to update their personal information (name, email, phone, address, birthday).                 | Provide profile management interface where users can view and edit their information. Validate email uniqueness (excluding current user), update User table, and optionally send notification on email/password change.                                                                                                                                                          |
| US-05 | Manage Personal Bookings  | As a **Customer/Staff**, I want to **book a trip**, so that **I can secure seats for my desired tour**.                                         | Customers and staff need to create bookings for trips with passenger details.                            | Display trip booking form with fields for number of adults/children and traveler information (name, gender, DOB, identity document). Validate seat availability, create Tour_Booking, Tour_Booking_Detail, Booking_Traveler records, generate Invoice, update booked_seats, and send confirmation email.                                                                         |
| US-06 | Manage Personal Bookings  | As a **Customer/Staff**, I want to **edit upcoming trip's passenger details**, so that **I can correct traveler information before departure**. | Users need to modify traveler details for confirmed bookings (must be at least 3 days before departure). | Allow editing of Booking_Traveler records for bookings with status PENDING/CONFIRMED and departure_date ≥ current_date + 3 days. Update traveler information and notify about changes.                                                                                                                                                                                           |
| US-07 | Manage Personal Bookings  | As a **Customer**, I want to **view and filter my personal bookings**, so that **I can track all my trip reservations**.                        | Customers need to see their booking history and upcoming trips.                                          | Query Tour_Booking by user_id with JOINs to Trip, Route, and Invoice. Display in tabs: Upcoming (PENDING/CONFIRMED with future dates), Completed (COMPLETED), Canceled (CANCELED). Provide filters by status, payment status, date range, and route name.                                                                                                                        |
| US-08 | Manage Personal Bookings  | As a **Customer**, I want to **view and pay booking invoice details**, so that **I can complete payment for my reservations**.                  | Customers need to view invoice details and make payments.                                                | Display Invoice information with payment_status = UNPAID. Allow selection of payment method and amount (minimum 30%). After successful payment, update Invoice.payment_status to PAID, Tour_Booking.status to CONFIRMED, and send confirmation email with e-ticket.                                                                                                              |
| US-09 | Browse Trips              | As a **Customer/Staff**, I want to **view and filter available trips**, so that **I can find trips that match my criteria**.                    | Users need to search and filter trips from homepage/search page.                                         | Query trips with filters: keyword (route name, attraction name), start/end location, departure date range, price range, duration, category. Display trips with route info, departure date, price, and available seats (total_seats - booked_seats).                                                                                                                              |
| US-10 | Browse Trips              | As a **Customer/Staff**, I want to **view trip details**, so that **I can see complete information about a specific trip**.                     | Users need detailed information about a trip including route itinerary and schedule.                     | Display trip information: route details (name, start/end location, duration, image), daily itinerary from Route_Attraction, trip specifics (departure/return dates, price, available seats, pickup time/location), and booking button.                                                                                                                                           |
| US-11 | Adjust Cart               | As a **Customer**, I want to **add a trip to my cart**, so that **I can book multiple trips together later**.                                   | Customers want to collect multiple trips before checkout.                                                | Check user authentication, get or create Cart for user, check if trip exists in cart (update quantity if exists, insert new Cart_Item if not), validate seat availability, and display success message.                                                                                                                                                                          |
| US-12 | Adjust Cart               | As a **Customer**, I want to **remove a trip from my cart**, so that **I can remove trips I no longer want to book**.                           | Customers need to manage cart contents by removing unwanted items.                                       | Display confirmation dialog, delete Cart_Item by id, update cart display, and show updated total.                                                                                                                                                                                                                                                                                |
| US-13 | Adjust Cart               | As a **Customer**, I want to **edit cart details**, so that **I can adjust trip dates, quantity, or passenger information**.                    | Customers need to modify cart items before checkout.                                                     | Allow editing of quantity (seats) and validate against available seats. Update Cart_Item and recalculate total cost.                                                                                                                                                                                                                                                             |
| US-14 | Adjust Cart               | As a **Customer**, I want to **view and filter trips in my cart**, so that **I can review items before checkout**.                              | Customers need to see all cart items with total cost.                                                    | Query Cart_Item with JOINs to Trip and Route. Display: route name, departure date, quantity, price per person, subtotal. Show cart total: SUM(quantity × price). Provide checkout button.                                                                                                                                                                                        |
| US-15 | Adjust Favorite Trips     | As a **Customer**, I want to **favorite a trip**, so that **I can easily find it later**.                                                       | Customers want to bookmark interesting routes for future reference.                                      | Check authentication, insert record into Favorite_Tour (user_id, route_id), update UI to show favorited status (change heart icon color).                                                                                                                                                                                                                                        |
| US-16 | Adjust Favorite Trips     | As a **Customer**, I want to **unfavorite a trip**, so that **I can remove routes I'm no longer interested in**.                                | Customers want to remove routes from their favorites list.                                               | Delete from Favorite_Tour where user_id and route_id match, update UI to show unfavorited status.                                                                                                                                                                                                                                                                                |
| US-17 | Adjust Favorite Trips     | As a **Customer**, I want to **view and filter favorite trips**, so that **I can browse my saved routes**.                                      | Customers need to access their favorited routes with filtering options.                                  | Query Favorite_Tour with JOIN to Route where user_id matches and route.status = OPEN. Provide filters by price, location, and date. Allow unfavorite directly from this list.                                                                                                                                                                                                    |
| US-18 | Manage Routes             | As a **Admin**, I want to **add a new route**, so that **I can expand the tour offerings**.                                                     | Admin needs to create new tour routes with complete information.                                         | Provide form for route details: name, start/end location, duration_days, image, status (default OPEN). Validate name uniqueness, duration > 0, insert into Route table, and redirect to route schedule management to add attractions.                                                                                                                                            |
| US-19 | Manage Routes             | As a **Staff/Admin**, I want to **view route details**, so that **I can see complete route information and statistics**.                        | Staff and admin need detailed route information including trip count and itinerary.                      | Query Route with COUNT of trips and total bookings. Display: basic info (name, locations, duration, image, status), total trips, itinerary from Route_Attraction grouped by day, and action buttons (Edit, Delete).                                                                                                                                                              |
| US-20 | Manage Routes             | As a **Admin**, I want to **edit route details**, so that **I can update tour information when needed**.                                        | Admin needs to modify existing route information.                                                        | Load current Route data, provide edit form with validation. Check constraints: if changing status to CLOSED, verify no active trips (SCHEDULED/ONGOING); if reducing duration_days, ensure ≥ MAX(day) in Route_Attraction. Update Route table and show success message.                                                                                                          |
| US-21 | Manage Routes             | As a **Admin**, I want to **delete a route**, so that **I can remove routes that are no longer offered**.                                       | Admin needs to remove routes from the system.                                                            | Check for dependencies (Trip, Favorite_Tour counts). If dependencies exist, show error and suggest changing status to CLOSED instead. If no dependencies, confirm deletion and cascade delete Route_Attraction then Route.                                                                                                                                                       |
| US-22 | Manage Routes             | As a **Staff/Admin**, I want to **view and filter routes**, so that **I can manage tour routes efficiently**.                                   | Staff and admin need to browse and search routes.                                                        | Query Route with LEFT JOIN to count trips per route. Display: name, start/end location, duration, trip count, status. Provide filters: status (OPEN/ONGOING/CLOSED), location, duration. Show action buttons for each route.                                                                                                                                                     |
| US-23 | Manage Route Schedule     | As a **Admin**, I want to **add a new itinerary day for a route**, so that **I can define daily activities and attractions**.                   | Admin needs to create daily itinerary entries for routes.                                                | Provide form to add Route_Attraction: select day (1 to duration_days), select attraction from list, set order_in_day, add activity_description. Validate day ≤ route.duration_days and order_in_day > 0. Insert into Route_Attraction.                                                                                                                                           |
| US-24 | Manage Route Schedule     | As a **Staff/Admin**, I want to **view route schedule**, so that **I can see the daily itinerary for a route**.                                 | Staff and admin need to see complete route itinerary organized by day.                                   | Query Route_Attraction with JOIN to Attraction where route_id matches. Display grouped by day with order_in_day: day number, attraction name/description/location, activity description.                                                                                                                                                                                         |
| US-25 | Manage Route Schedule     | As a **Admin**, I want to **edit itinerary details**, so that **I can update attraction information or activities for a day**.                  | Admin needs to modify existing itinerary entries.                                                        | Load Route_Attraction record, allow editing of attraction_id, order_in_day, and activity_description. Validate constraints and update record.                                                                                                                                                                                                                                    |
| US-26 | Manage Route Schedule     | As a **Admin**, I want to **delete an itinerary day**, so that **I can remove attractions that are no longer part of the tour**.                | Admin needs to remove itinerary entries from routes.                                                     | Confirm deletion, delete from Route_Attraction by id, reload schedule display.                                                                                                                                                                                                                                                                                                   |
| US-27 | Manage Attraction         | As a **Admin**, I want to **add a new attraction**, so that **I can expand the database of tourist locations**.                                 | Admin needs to create new attraction records for use in routes.                                          | Provide form: name, description, location, category_id, status (default ACTIVE). Validate name not empty, insert into Attraction table.                                                                                                                                                                                                                                          |
| US-28 | Manage Attraction         | As a **Staff/Admin**, I want to **view attraction details**, so that **I can see complete information about a tourist location**.               | Staff and admin need detailed attraction information.                                                    | Query Attraction with JOIN to Category. Display: name, description, location, category name, status, and list of routes using this attraction (via Route_Attraction).                                                                                                                                                                                                            |
| US-29 | Manage Attraction         | As a **Admin**, I want to **edit attraction details**, so that **I can update location information when needed**.                               | Admin needs to modify existing attraction records.                                                       | Load Attraction data, provide edit form for all fields except id. Validate and update Attraction table.                                                                                                                                                                                                                                                                          |
| US-30 | Manage Attraction         | As a **Admin**, I want to **delete an attraction**, so that **I can remove locations no longer available**.                                     | Admin needs to remove attractions from the system.                                                       | Check if attraction is used in any Route_Attraction. If used, show error message "Cannot delete - used in routes". If not used, change status to DELETED (soft delete) rather than physical delete.                                                                                                                                                                              |
| US-31 | Manage Attraction         | As a **Staff/Admin**, I want to **view and filter attractions**, so that **I can manage tourist locations**.                                    | Staff and admin need to browse and search attractions.                                                   | Query Attraction with JOIN to Category where status != DELETED. Display: name, location, category, status. Provide filters: category, status, keyword (name/location). Show action buttons for each.                                                                                                                                                                             |
| US-32 | Manage Trips              | As a **Admin**, I want to **add a new trip**, so that **I can schedule departures for routes**.                                                 | Admin needs to create trip instances for routes.                                                         | Provide form: select route_id, set departure_date (≥ today + 7 days), calculate return_date (departure + duration_days - 1), set price, total_seats, pickup_time/location, status (default SCHEDULED). Validate and insert into Trip with booked_seats = 0.                                                                                                                      |
| US-33 | Manage Trips              | As a **Staff/Admin**, I want to **view trip details**, so that **I can see trip information and booking status**.                               | Staff and admin need detailed trip information.                                                          | Query Trip with JOIN to Route. Display: route name/info, departure/return dates, price, total_seats, booked_seats, available_seats, pickup details, status, and list of bookings for this trip.                                                                                                                                                                                  |
| US-34 | Manage Trips              | As a **Admin**, I want to **edit trip details**, so that **I can update trip information**.                                                     | Admin needs to modify trip information.                                                                  | Check if trip has bookings. If no bookings, allow editing all fields. If has bookings, only allow: increasing price, increasing total_seats, changing pickup_time/location. Validate constraints and update Trip table.                                                                                                                                                          |
| US-35 | Manage Trips              | As a **Staff/Admin**, I want to **add a new booking for a trip**, so that **I can help customers book tours**.                                  | Staff and admin can create bookings on behalf of customers.                                              | Display booking form with trip details. Select customer (or create new), enter number of adults/children, add traveler details for each person. Validate seat availability, create Tour_Booking, Tour_Booking_Detail, Booking_Traveler records, generate Invoice, update booked_seats, send email.                                                                               |
| US-36 | Manage Trips              | As a **Admin**, I want to **delete a trip**, so that **I can cancel trips that won't proceed**.                                                 | Admin needs to remove or cancel scheduled trips.                                                         | Check for existing bookings. If bookings exist, show warning about 100% refund policy and require confirmation. Update all related Tour_Booking.status to CANCELED, Invoice.payment_status to REFUNDED (if paid), Trip.status to CANCELED. Send email notifications to all affected customers. If no bookings, simply update Trip.status to CANCELED.                            |
| US-37 | Manage Trips              | As a **Staff/Admin**, I want to **view and filter trips**, so that **I can manage all scheduled tours**.                                        | Staff and admin need to browse and search trips.                                                         | Query Trip with JOIN to Route. Display: route name, departure date, price, capacity (booked/total), status. Provide filters: route, status, date range, occupancy level (available/nearly full/sold out).                                                                                                                                                                        |
| US-38 | Adjust and Track Bookings | As a **Staff**, I want to **add a new booking**, so that **I can process customer reservations**.                                               | Staff needs to create bookings for walk-in or phone customers.                                           | Display booking form: select trip, select/create customer, enter passenger count (adults/children) and traveler details. Validate seat availability, create Tour_Booking, Tour_Booking_Detail, Booking_Traveler, Invoice records, update Trip.booked_seats, send confirmation email.                                                                                             |
| US-39 | Adjust and Track Bookings | As a **Staff**, I want to **view booking details**, so that **I can see complete reservation information**.                                     | Staff needs detailed booking information to assist customers.                                            | Query Tour_Booking with JOINs to Trip, Route, User, Invoice. Display: customer info, route/trip details, booking status, passenger count, traveler list, payment status, total amount, action buttons (Edit, Cancel, View Invoice).                                                                                                                                              |
| US-40 | Adjust and Track Bookings | As a **Staff**, I want to **edit pre-departure booking**, so that **I can update booking details before the trip starts**.                      | Staff needs to modify bookings before departure date.                                                    | Check if booking.status is PENDING/CONFIRMED and departure_date ≥ today + 3 days. Allow editing passenger details and quantity. Validate seat availability if increasing quantity, update records, and notify customer of changes.                                                                                                                                               |
| US-41 | Adjust and Track Bookings | As a **Staff**, I want to **delete a booking**, so that **I can cancel reservations when needed**.                                              | Staff needs to cancel bookings and process refunds.                                                      | Check booking.status (must be PENDING/CONFIRMED). Display refund policy based on days until departure (15+ days: 80%, 7-14 days: 50%, 3-6 days: 20%, <3 days: 0%). Require confirmation, update Tour_Booking.status to CANCELED, Invoice.payment_status to REFUNDED (if applicable), decrement Trip.booked_seats, create refund request, send confirmation email.                |
| US-42 | Adjust and Track Bookings | As a **Staff**, I want to **view and filter bookings**, so that **I can manage all reservations efficiently**.                                  | Staff needs to browse and search all bookings.                                                           | Query Tour_Booking with JOINs to Trip, Route, User, Invoice. Display: customer name, route name, departure date, booking status, payment status, total amount. Provide filters: status, payment status, date range, customer name/email, route name.                                                                                                                             |
| US-43 | Adjust and Track Bookings | As a **Staff**, I want to **view booking invoice**, so that **I can check payment details for a reservation**.                                  | Staff needs to view and verify invoice information.                                                      | Query Invoice with JOIN to Tour_Booking. Display: invoice id, booking details, total amount, payment status, payment method, payment date (if paid), outstanding balance. Show payment history if partial payments.                                                                                                                                                              |
| US-44 | Adjust Customers          | As a **Staff/Admin**, I want to **add a new customer**, so that **I can create accounts for walk-in customers**.                                | Staff and admin can register customers who don't self-register.                                          | Provide customer registration form: username, password, full_name, email, phone_number, address, birthday, gender. Validate username/email uniqueness, password strength (≥8 chars, mixed case, numbers), birthday (≥18 years old). Insert User with role=CUSTOMER, create Cart, send welcome email.                                                                             |
| US-45 | Adjust Customers          | As a **Staff/Admin**, I want to **view customer details**, so that **I can see customer information and booking history**.                      | Staff and admin need comprehensive customer information.                                                 | Query User where role=CUSTOMER with statistics: total bookings (COUNT), total spent (SUM), completed/canceled counts (CASE aggregations). Display: personal info (username, email, phone, address, birthday, gender, is_lock), booking statistics, recent 10 bookings with route/trip info, favorite routes, action buttons (Edit, Delete, Lock/Unlock).                         |
| US-46 | Adjust Customers          | As a **Staff/Admin**, I want to **edit customer information**, so that **I can update customer details**.                                       | Staff and admin need to modify customer records.                                                         | Load User data, display edit form with username read-only (immutable). Allow editing: full_name, email (validate uniqueness excluding self), phone_number, address, birthday, gender, password (optional). Send notification email if email/password changed. Update User table.                                                                                                 |
| US-47 | Adjust Customers          | As a **Staff/Admin**, I want to **delete a customer**, so that **I can remove customer accounts**.                                              | Staff and admin need to remove or disable customer accounts.                                             | Check constraints: active bookings (status PENDING/CONFIRMED), unpaid invoices. If constraints exist, show error and suggest using "Disable Account" (is_lock=true) instead. Display confirmation dialog with two options: "Disable Account" (UPDATE is_lock=true) or "Delete Permanently" (cascade delete Cart_Item → Cart → Favorite_Tour → User). Log action and reload list. |
| US-48 | Adjust Customers          | As a **Staff/Admin**, I want to **view and filter customers**, so that **I can manage customer accounts**.                                      | Staff and admin need to browse and search customers.                                                     | Query User where role=CUSTOMER with LEFT JOIN to count bookings and calculate total spent. Display: username, full_name, email, phone, is_lock, total_bookings, total_spent. Provide filters: keyword (name/email/username), phone, is_lock status, gender. Show action buttons for each customer.                                                                               |
| US-49 | Adjust Staffs             | As a **Admin**, I want to **add a new staff**, so that **I can create employee accounts**.                                                      | Admin needs to create staff accounts.                                                                    | Provide staff registration form: username, password, full_name, email, phone_number, address, birthday (≥18 years), gender. Validate username/email uniqueness, password strength. Insert User with role=STAFF and is_lock=false, create Cart, send account creation email with login credentials.                                                                               |
| US-50 | Adjust Staffs             | As a **Admin**, I want to **view staff details**, so that **I can see employee information and work statistics**.                               | Admin needs comprehensive staff information.                                                             | Query User where role=STAFF with statistics: bookings handled (COUNT), trips created (COUNT), routes created (COUNT). Display: personal info, work statistics, recent 10 bookings handled, action buttons (Edit, Delete, Lock/Unlock, View Full History).                                                                                                                        |
| US-51 | Adjust Staffs             | As a **Admin**, I want to **edit staff information**, so that **I can update employee details**.                                                | Admin needs to modify staff records.                                                                     | Load User data, display edit form with username read-only. Allow editing: full_name, email (validate uniqueness excluding self), phone_number, address, birthday, gender, password (optional, validate strength if provided). Send notification email if email/password changed. Update User table.                                                                              |
| US-52 | Adjust Staffs             | As a **Admin**, I want to **delete a staff**, so that **I can remove employee accounts**.                                                       | Admin needs to remove or disable staff accounts.                                                         | Check if staff has active work: bookings with PENDING/CONFIRMED status. If active work exists, show error and suggest "Disable Account" instead. Display confirmation with two options: "Disable Account" (UPDATE is_lock=true) or "Delete Permanently" (cascade delete Cart_Item → Cart → Favorite_Tour → User). Log action and reload list.                                    |
| US-53 | Adjust Staffs             | As a **Admin**, I want to **view and filter staffs**, so that **I can manage employee accounts**.                                               | Admin needs to browse and search staff members.                                                          | Query User where role=STAFF with LEFT JOIN to count managed bookings. Display: username, full_name, email, phone, is_lock, total_managed_bookings. Provide filters: keyword (name/email/username), phone, is_lock status, gender. Show action buttons for each staff.                                                                                                            |
| US-54 | Reports                   | As a **Admin**, I want to **view reports**, so that **I can analyze business performance and make decisions**.                                  | Admin needs comprehensive system reports and analytics.                                                  | Generate reports: route performance (bookings, revenue), customer statistics (new registrations, top spenders, violations), booking trends (by day/month/year, cancellation rate, payment compliance), revenue analysis (by period, payment methods), trip occupancy rates. Display with charts, filters by date range, and export options.                                      |

## Summary

This document contains **54 user stories** covering all use cases in the Tourist Management System:

### By Actor:

- **Customer**: 17 user stories (US-02, US-05-17)
- **Staff**: 27 user stories (US-01, US-05-06, US-09-10, US-22, US-24, US-28, US-31, US-33, US-35, US-37-48)
- **Admin**: 34 user stories (US-01, US-18-36, US-44-54)
- **All Users**: 4 user stories (US-01, US-03, US-04)

### By Function Group:

- **Authentication**: 4 stories (US-01 to US-04)
- **Manage Personal Bookings**: 4 stories (US-05 to US-08)
- **Browse Trips**: 2 stories (US-09 to US-10)
- **Adjust Cart**: 4 stories (US-11 to US-14)
- **Adjust Favorite Trips**: 3 stories (US-15 to US-17)
- **Manage Routes**: 5 stories (US-18 to US-22)
- **Manage Route Schedule**: 4 stories (US-23 to US-26)
- **Manage Attraction**: 5 stories (US-27 to US-31)
- **Manage Trips**: 6 stories (US-32 to US-37)
- **Adjust and Track Bookings**: 6 stories (US-38 to US-43)
- **Adjust Customers**: 5 stories (US-44 to US-48)
- **Adjust Staffs**: 5 stories (US-49 to US-53)
- **Reports**: 1 story (US-54)

### Acceptance Criteria

Each user story includes:

1. **Clear actor identification** (Customer/Staff/Admin/User)
2. **Specific functionality** desired
3. **Business value or constraint** justification
4. **Detailed description** of the requirement
5. **Technical solution** outlining implementation approach
