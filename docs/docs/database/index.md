-- BẢNG LOAISANH
CREATE TABLE LOAISANH (
MaLoaiSanh INT IDENTITY(1,1) PRIMARY KEY,
TenLoaiSanh NVARCHAR(40) UNIQUE NOT NULL,
DonGiaBanToiThieu MONEY
);

-- BẢNG SANH
CREATE TABLE SANH (
MaSanh INT IDENTITY(1,1) PRIMARY KEY,
MaLoaiSanh INT,
TenSanh NVARCHAR(40) UNIQUE NOT NULL,
SoLuongBanToiDa INT,
GhiChu NVARCHAR(100),
FOREIGN KEY (MaLoaiSanh) REFERENCES LOAISANH(MaLoaiSanh)
);

-- BẢNG CA
CREATE TABLE CA (
MaCa INT IDENTITY(1,1) PRIMARY KEY,
TenCa NVARCHAR(40) UNIQUE NOT NULL,
ThoiGianBatDauCa TIME,
ThoiGianKetThucCa TIME
);

-- BẢNG PHIEUDATTIEC
CREATE TABLE PHIEUDATTIEC (
MaPhieuDat INT IDENTITY(1,1) PRIMARY KEY,
TenChuRe NVARCHAR(40),
TenCoDau NVARCHAR(40),
DienThoai VARCHAR(10),
NgayDatTiec SMALLDATETIME,
NgayDaiTiec SMALLDATETIME,
MaCa INT,
MaSanh INT,
TienDatCoc MONEY,
SoLuongBan INT,
SoBanDuTru INT,
NgayThanhToan SMALLDATETIME,
DonGiaBanTiec MONEY,
TongTienBan MONEY,
TongTienDV MONEY,
TongTienHoaDon MONEY,
TienConLai MONEY,
ChiPhiPhatSinh MONEY,
TienPhat MONEY,
FOREIGN KEY (MaCa) REFERENCES CA(MaCa),
FOREIGN KEY (MaSanh) REFERENCES SANH(MaSanh)
);

-- BẢNG MONAN
CREATE TABLE MONAN (
MaMonAn INT IDENTITY(1,1) PRIMARY KEY,
TenMonAn NVARCHAR(40) UNIQUE NOT NULL,
DonGia MONEY,
GhiChu NVARCHAR(100)
);

-- BẢNG THUCDON
CREATE TABLE THUCDON (
MaPhieuDat INT,
MaMonAn INT,
SoLuong INT,
DonGia MONEY,
GhiChu NVARCHAR(100),
PRIMARY KEY (MaPhieuDat, MaMonAn),
FOREIGN KEY (MaPhieuDat) REFERENCES PHIEUDATTIEC(MaPhieuDat),
FOREIGN KEY (MaMonAn) REFERENCES MONAN(MaMonAn)
);

-- BẢNG DICHVU
CREATE TABLE DICHVU (
MaDichVu INT IDENTITY(1,1) PRIMARY KEY,
TenDichVu NVARCHAR(40) UNIQUE NOT NULL,
DonGia MONEY,
GhiChu NVARCHAR(100)
);

-- BẢNG CHITIETDV
CREATE TABLE CHITIETDV (
MaPhieuDat INT,
MaDichVu INT,
SoLuong INT,
DonGia MONEY,
ThanhTien MONEY,
GhiChu NVARCHAR(100),
PRIMARY KEY (MaPhieuDat, MaDichVu),
FOREIGN KEY (MaPhieuDat) REFERENCES PHIEUDATTIEC(MaPhieuDat),
FOREIGN KEY (MaDichVu) REFERENCES DICHVU(MaDichVu)
);

-- BẢNG BAO CAO DOANH THU
CREATE TABLE BAOCAODS (
Thang INT,
Nam INT,
TongDoanhThu MONEY,
PRIMARY KEY (Thang, Nam)
);

CREATE TABLE CTBAOCAODS (
Ngay INT,
Thang INT,
Nam INT,
SoLuongTiec INT,
DoanhThu MONEY,
TiLe DECIMAL(7,2),
PRIMARY KEY (Ngay, Thang, Nam),
FOREIGN KEY (Thang, Nam) REFERENCES BAOCAODS(Thang, Nam)
);

-- BẢNG THAM SỐ
CREATE TABLE THAMSO (
TenThamSo NVARCHAR(100) PRIMARY KEY,
GiaTri DECIMAL(5,2)
);

INSERT INTO THAMSO (TenThamSo, GiaTri) VALUES
('KiemTraPhat', 1), -- BIT: 0 = tắt, 1 = bật (giá trị mặc định có thể là 0)
('TiLePhat', 0.01), -- DECIMAL(5,2)
('TiLeTienDatCocToiThieu', 0.15), -- DECIMAL(5,2)
('TiLeSoBanDatTruocToiThieu', 0.85); -- DECIMAL(5,2)

-- BẢNG PHÂN QUYỀN
CREATE TABLE CHUCNANG (
MaChucNang VARCHAR(10) PRIMARY KEY,
TenChucNang NVARCHAR(100),
TenManHinhDuocLoad NVARCHAR(100)
);

CREATE TABLE NHOMNGUOIDUNG (
MaNhom VARCHAR(10) PRIMARY KEY,
TenNhom NVARCHAR(100) UNIQUE NOT NULL
);

CREATE TABLE PHANQUYEN (
MaNhom VARCHAR(10),
MaChucNang VARCHAR(10),
PRIMARY KEY (MaNhom, MaChucNang),
FOREIGN KEY (MaNhom) REFERENCES NHOMNGUOIDUNG(MaNhom),
FOREIGN KEY (MaChucNang) REFERENCES CHUCNANG(MaChucNang)
);

CREATE TABLE NGUOIDUNG (
MaNguoiDung INT PRIMARY KEY IDENTITY(1,1),
TenDangNhap VARCHAR(50) UNIQUE NOT NULL,
MatKhauHash VARCHAR(256) NOT NULL,
HoTen NVARCHAR(100),
Email VARCHAR(100),
SoDienThoai
DiaChi
NgaySinh
GioiTinh
MaNhom VARCHAR(10),
FOREIGN KEY (MaNhom) REFERENCES NHOMNGUOIDUNG(MaNhom)
);
